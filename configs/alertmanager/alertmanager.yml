global:
  # Update with your actual SMTP server
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'ethereum.nodealerts@gmail.com'
  smtp_auth_username: 'ethereum.nodealerts@gmail.com'
  smtp_auth_password: 'izxc qxet ngwi lhmc'  
  smtp_require_tls: true
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: 'default'
  routes:
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 1h
      continue: true  
    
    - match:
        service: ethereum
      receiver: 'ethereum-alerts'
      routes:
        - match:
            alertname: EthereumNodeDown
          receiver: 'ethereum-critical'
          repeat_interval: 30m
    
    - match:
        service: system
      receiver: 'system-alerts'
    
    - match:
        service: monitoring
      receiver: 'monitoring-alerts'
      group_interval: 10m  

receivers:
  - name: 'default'
    email_configs:
      - to: 'alerts@yourdomain.com'
        subject: '[ETHEREUM-NODE] {{ .GroupLabels.alertname }}'
        body: |
          Alert Summary: {{ len .Alerts }} alert(s)
          
          {{ range .Alerts }}
          ğŸ”” {{ .Annotations.summary }}
          ğŸ“‹ {{ .Annotations.description }}
          ğŸ·ï¸ Severity: {{ .Labels.severity }}
          ğŸ“… Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
          {{ if gt (len .Labels.instance) 0 }}ğŸ“ Instance: {{ .Labels.instance }}{{ end }}
          
          {{ end }}

  - name: 'critical-alerts'
    email_configs:
      - to: 'devops-team@yourdomain.com, on-call@yourdomain.com'
        subject: '[ğŸš¨ CRITICAL] Ethereum Node - {{ .GroupLabels.alertname }}'
        body: |
          ğŸš¨ğŸš¨ğŸš¨ CRITICAL ALERT ğŸš¨ğŸš¨ğŸš¨
          
          {{ range .Alerts }}
          Alert: {{ .Annotations.summary }}
          Description: {{ .Annotations.description }}
          Instance: {{ .Labels.instance }}
          Severity: {{ .Labels.severity }}
          Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
          
          {{ if .Annotations.runbook_url }}
          ğŸ“– Runbook: {{ .Annotations.runbook_url }}
          {{ end }}
          
          {{ if .GeneratorURL }}
          ğŸ”— Alert Source: {{ .GeneratorURL }}
          {{ end }}
          {{ end }}
        headers:
          Priority: 'high'
          X-Priority: '1'

  - name: 'ethereum-alerts'
    email_configs:
      - to: 'blockchain-team@yourdomain.com'
        subject: '[â›“ï¸ ETHEREUM] {{ .GroupLabels.alertname }}'
        body: |
          Ethereum Node Alert Details:
          
          {{ range .Alerts }}
          ğŸ”” Alert: {{ .Annotations.summary }}
          ğŸ“‹ Description: {{ .Annotations.description }}
          ğŸ“ Instance: {{ .Labels.instance }}
          ğŸ·ï¸ Severity: {{ .Labels.severity }}
          ğŸ“… Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
          
          {{ if .Annotations.runbook_url }}
          ğŸ“– Runbook: {{ .Annotations.runbook_url }}
          {{ end }}
          {{ end }}

  - name: 'ethereum-critical'
    email_configs:
      - to: 'blockchain-team@yourdomain.com, devops-team@yourdomain.com'
        subject: '[ğŸš¨ ETHEREUM DOWN] Node Offline - Immediate Action Required'
        body: |
          ğŸš¨ ETHEREUM NODE DOWN ğŸš¨
          
          {{ range .Alerts }}
          Your Ethereum node has stopped responding!
          
          Instance: {{ .Labels.instance }}
          Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
          Duration: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
          
          Immediate actions:
          1. Check node logs: docker logs geth-node
          2. Check system resources
          3. Verify network connectivity
          4. Check disk space
          {{ end }}

  - name: 'system-alerts'
    email_configs:
      - to: 'sysadmin@yourdomain.com'
        subject: '[ğŸ–¥ï¸ SYSTEM] {{ .GroupLabels.alertname }}'
        body: |
          System Alert Details:
          
          {{ range .Alerts }}
          ğŸ”” Alert: {{ .Annotations.summary }}
          ğŸ“‹ Description: {{ .Annotations.description }}
          ğŸ“ Instance: {{ .Labels.instance }}
          ğŸ·ï¸ Severity: {{ .Labels.severity }}
          ğŸ“… Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
          {{ end }}

  - name: 'monitoring-alerts'
    email_configs:
      - to: 'monitoring-team@yourdomain.com'
        subject: '[ğŸ“Š MONITORING] {{ .GroupLabels.alertname }}'
        body: |
          Monitoring System Alert:
          
          {{ range .Alerts }}
          ğŸ”” Alert: {{ .Annotations.summary }}
          ğŸ“‹ Description: {{ .Annotations.description }}
          ğŸ·ï¸ Service: {{ .Labels.service }}
          ğŸ·ï¸ Severity: {{ .Labels.severity }}
          ğŸ“… Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
          {{ end }}

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'cluster', 'service', 'instance']
  
  # Inhibit node alerts when the entire service is down
  - source_match:
      alertname: 'EthereumNodeDown'
    target_match_re:
      alertname: 'High.*|Low.*'
    equal: ['instance']

# Mute rules for maintenance windows 
mute_time_intervals:
  - name: 'maintenance-window'
    time_intervals:
      - times:
          - start_time: '02:00'
            end_time: '04:00'
        weekdays: ['sunday']